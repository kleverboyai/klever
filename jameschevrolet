(function () {
    function loadChatWidget() {
        if (!window.chatLoaded) {
            window.chatLoaded = true;

            // Remove the chat button after it's clicked
            let loadChatBtn = document.getElementById("load-chat-widget");
            if (loadChatBtn) {
                loadChatBtn.remove();
            }

            // Load the GoHighLevel chat widget script dynamically
            let chatScript = document.createElement("script");
            chatScript.src = "https://widgets.leadconnectorhq.com/loader.js";
            chatScript.dataset.resourcesUrl = "https://widgets.leadconnectorhq.com/chat-widget/loader.js";
            chatScript.dataset.widgetId = "67c6432190a113d8075ab54e";
            chatScript.async = true;
            document.body.appendChild(chatScript);

            // Wait for the script to load, then open the chat
            chatScript.onload = function () {
                if (window.LC_API) {
                    setTimeout(() => {
                        window.LC_API.open_chat();
                    }, 1000); // Delay ensures chat initializes properly
                }
            };
        } else {
            if (window.LC_API) {
                window.LC_API.open_chat();
            }
        }
    }

    API.insert("page-footer", (elem) => {
        const div = document.createElement("div");
        div.innerHTML = `
            <button id="load-chat-widget" style="position: fixed; bottom: 20px; right: 20px; padding: 20px 25px; background: #D90A0AFF; color: #FFF; border: none; border-radius: 10px; cursor: pointer; z-index: 1000;">
                Available 24/7
            </button>
        `;
        API.append(elem, div);

        // Attach click event to the inserted button
        document.getElementById("load-chat-widget").addEventListener("click", loadChatWidget);
    });
})();
